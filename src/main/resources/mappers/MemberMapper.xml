<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo132.mapper.MemberMapper">

  <!-- selectMemberDetail --> 

  <select id="selectMemberDetail" resultType="memberDto">
    select * from tb_member where mem_no=#{mem_no}
  </select>
  
  <!-- selectMemberList --> 

  <select id="selectMemberList" resultType="memberDto">
    select *
    from (
      select rownum rn, t.*
      from (
        select *
        from tb_member
        where 1=1
          <if test="searchWord != null and searchWord != ''">
            <if test="searchField == 'regdate'">
              <![CDATA[    
              and to_char(${searchField},'yyyy-mm-dd') = #{searchWord}
              ]]>
            </if>
            <if test="searchField == 'id' or searchField == 'name'">
              and ${searchField} = #{searchWord}
            </if>
          </if>
        order by regdate desc
      ) t
    )
    where rn between #{pageNo} * #{amount} - ( #{amount} - 1 )
    and #{pageNo} * #{amount}
  </select>

  <!-- selectTotalCnt --> 

  <select id="selectTotalCnt">
    select count(*)
    from tb_member
    where 1=1
    <if test="searchWord != null and searchWord != ''">
      <if test="searchField == 'regdate'">
        <![CDATA[    
        and to_char(${searchField},'yyyy-mm-dd') = #{searchWord}
        ]]>
      </if>
      <if test="searchField == 'id' or searchField == 'name'">
        and ${searchField} = #{searchWord}
      </if>
    </if>
  </select>

  <!-- deleteMember --> 

  <delete id="deleteMember">
    delete from tb_member 
    where mem_no = #{mem_no}
  </delete>

  <!-- updateMember --> 

  <update id="updateMember">
    update tb_member
    set id = #{id}, name = #{name}, gender = #{gender}, addr = #{addr}
    where mem_no=#{mem_no}
  </update>
</mapper>